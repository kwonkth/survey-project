<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì„¤ë¬¸ ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ - Fantasy Quest</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Gowun+Batang:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <style>
        .dashboard-container {
            display: grid;
            grid-template-columns: 1fr 1.2fr;
            gap: 2rem;
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .survey-folder-section {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            padding: 2rem;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #f0f0f0;
        }

        .section-header h2 {
            margin: 0;
            color: #2c3e50;
            font-size: 1.3rem;
        }

        .btn-add-folder {
            background: #4a6baf;
            color: white;
            border: none;
            padding: 0.6rem 1.2rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.3s;
        }

        .btn-add-folder:hover {
            background: #3a5a9a;
        }

        .folder-list {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }

        .folder-item {
            display: flex;
            align-items: center;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            border-left: 4px solid transparent;
        }

        .folder-item:hover {
            background: #e9ecef;
            border-left-color: #4a6baf;
        }

        .folder-item.active {
            background: #e8f0ff;
            border-left-color: #4a6baf;
        }

        .folder-item.drag-over-folder {
            background: #e0ecff;
            border-left-color: #4a6baf;
        }

        .folder-icon {
            font-size: 1.5rem;
            margin-right: 1rem;
        }

        .folder-info {
            flex: 1;
        }

        .folder-name {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 0.2rem;
        }

        .folder-count {
            font-size: 0.85rem;
            color: #7f8c8d;
        }

        .folder-actions {
            display: flex;
            gap: 0.5rem;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .folder-item:hover .folder-actions {
            opacity: 1;
        }

        .btn-icon-small {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            padding: 0.3rem;
            transition: transform 0.2s;
        }

        .btn-icon-small:hover {
            transform: scale(1.2);
        }

        .survey-grid-section {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            padding: 2rem;
        }

        .survey-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .survey-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 1.5rem;
            transition: all 0.3s;
            cursor: move;
            box-shadow: 0 1px 4px rgba(0,0,0,0.05);
        }

        .survey-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.12);
            transform: translateY(-2px);
            border-color: #4a6baf;
        }

        .survey-card.dragging {
            opacity: 0.5;
        }

        .survey-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .survey-status {
            display: inline-block;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-draft {
            background: #fff3cd;
            color: #856404;
        }

        .status-active {
            background: #d4edda;
            color: #155724;
        }

        .status-closed {
            background: #f8d7da;
            color: #721c24;
        }

        .survey-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 0.8rem;
            line-height: 1.4;
        }

        .survey-meta {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            font-size: 0.85rem;
            color: #7f8c8d;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #f0f0f0;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .survey-progress {
            margin-bottom: 1rem;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            margin-bottom: 0.4rem;
            color: #2c3e50;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4a6baf, #6a8bcf);
            transition: width 0.3s;
        }

        .survey-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn-survey-action {
            flex: 1;
            padding: 0.6rem;
            border: 1px solid #ddd;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s;
        }

        .btn-survey-action:hover {
            background: #f8f9fa;
            border-color: #4a6baf;
            color: #4a6baf;
        }

        .btn-survey-action.btn-survey-delete {
            border-color: #f5c6cb;
            color: #c0392b;
            background: #fff5f5;
        }

        .btn-survey-action.btn-survey-delete:hover {
            background: #f8d7da;
            border-color: #c0392b;
            color: #c0392b;
        }

        .response-analysis-section {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            padding: 2rem;
            margin-top: 2rem;
        }

        .analysis-header {
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #f0f0f0;
        }

        .analysis-header h3 {
            margin: 0;
            color: #2c3e50;
            font-size: 1.2rem;
        }

        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .analysis-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .analysis-card.completion {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .analysis-card.dropoff {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .analysis-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .analysis-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .dropoff-chart-container {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 2rem;
        }

        .dropoff-chart-title {
            font-size: 1rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 1rem;
        }

        .dropoff-chart {
            position: relative;
            height: 300px;
            margin-bottom: 1rem;
        }

        .question-dropoff-item {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
            padding: 1rem;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #e0e0e0;
        }

        .question-dropoff-item.high-dropoff {
            border-left-color: #f5576c;
            background: #fff5f5;
        }

        .question-number {
            font-weight: 600;
            color: #4a6baf;
            margin-right: 1rem;
            min-width: 40px;
        }

        .question-text {
            flex: 1;
            color: #2c3e50;
            font-size: 0.95rem;
            margin-bottom: 0.5rem;
        }

        .dropoff-stats {
            display: flex;
            gap: 1rem;
            font-size: 0.85rem;
        }

        .dropoff-rate {
            color: #f5576c;
            font-weight: 600;
        }

        .response-count {
            color: #7f8c8d;
        }

        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: #7f8c8d;
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .empty-state-text {
            font-size: 1rem;
            margin-bottom: 0.5rem;
        }

        .empty-state-hint {
            font-size: 0.9rem;
            color: #95a5a6;
        }

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-dialog {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        .modal-header {
            margin-bottom: 1.5rem;
        }

        .modal-header h3 {
            margin: 0;
            color: #2c3e50;
        }

        .modal-body {
            margin-bottom: 1.5rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #2c3e50;
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 0.7rem;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 0.95rem;
            box-sizing: border-box;
        }

        .form-group input:focus {
            outline: none;
            border-color: #4a6baf;
            box-shadow: 0 0 0 3px rgba(74, 107, 175, 0.1);
        }

        .modal-footer {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }

        .btn-modal {
            padding: 0.7rem 1.5rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.95rem;
            transition: all 0.3s;
        }

        .btn-modal-primary {
            background: #4a6baf;
            color: white;
        }

        .btn-modal-primary:hover {
            background: #3a5a9a;
        }

        .btn-modal-secondary {
            background: #e9ecef;
            color: #2c3e50;
        }

        .btn-modal-secondary:hover {
            background: #dee2e6;
        }

        .filter-bar {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 0.6rem 1rem;
            border: 1px solid #ddd;
            background: white;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
        }

        .filter-btn.active {
            background: #4a6baf;
            color: white;
            border-color: #4a6baf;
        }

        .filter-btn:hover {
            border-color: #4a6baf;
        }

        .sort-selector {
            margin-left: auto;
        }

        .sort-selector select {
            padding: 0.6rem 1rem;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: white;
            cursor: pointer;
            font-size: 0.9rem;
        }

        @media (max-width: 1024px) {
            .dashboard-container {
                grid-template-columns: 1fr;
            }

            .survey-grid {
                grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .survey-grid {
                grid-template-columns: 1fr;
            }

            .analysis-grid {
                grid-template-columns: 1fr;
            }

            .filter-bar {
                flex-direction: column;
            }

            .sort-selector {
                margin-left: 0;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="logo" onclick="navigateTo('index.html')">ì„¤ë¬¸ ë§ˆë²•ì‚¬</div>
            <nav>
                <button class="nav-btn" onclick="navigateTo('index.html')">ëŒ€ì‹œë³´ë“œ</button>
                <button class="nav-btn active">ì„¤ë¬¸ ê´€ë¦¬</button>
                <button class="nav-btn" onclick="navigateTo('analytics.html')">ê²°ê³¼ ë¶„ì„</button>
            </nav>
        </header>

        <!-- Main Dashboard -->
        <div class="dashboard-container">
            <!-- Left Panel: Folder Management -->
            <div class="survey-folder-section">
                <div class="section-header">
                    <h2>ğŸ“ ì„¤ë¬¸ í´ë”</h2>
                    <button class="btn-add-folder" onclick="openAddFolderModal()">+ í´ë” ì¶”ê°€</button>
                </div>
                <div class="folder-list" id="folderList">
                    <!-- Folders will be populated here -->
                </div>
            </div>

            <!-- Right Panel: Survey Management -->
            <div class="survey-grid-section">
                <div class="section-header">
                    <h2>ğŸ“‹ ì„¤ë¬¸ ëª©ë¡</h2>
                    <button class="btn-add-folder" onclick="setAllSurveysActive()">ì „ì²´ ì„¤ë¬¸ ë°°í¬ ì‹œì‘</button>
                </div>

                <!-- Filter and Sort Bar -->
                <div class="filter-bar">
                    <button class="filter-btn active" onclick="filterSurveys('all')">ì „ì²´</button>
                    <button class="filter-btn" onclick="filterSurveys('draft')">ì‘ì„± ì¤‘</button>
                    <button class="filter-btn" onclick="filterSurveys('active')">ë°°í¬ ì¤‘</button>
                    <button class="filter-btn" onclick="filterSurveys('closed')">ì‘ë‹µ ì¢…ë£Œ</button>
                    <div class="sort-selector">
                        <select id="sortSelect" onchange="updateSurveySort()">
                            <option value="recent">ìµœê·¼ ìˆ˜ì •ìˆœ</option>
                            <option value="oldest">ì˜¤ë˜ëœìˆœ</option>
                            <option value="responses">ì‘ë‹µ ë§ì€ìˆœ</option>
                            <option value="title">ì œëª©ìˆœ</option>
                        </select>
                    </div>
                </div>

                <!-- Survey List Container (DB-driven) -->
                <div class="survey-grid" id="surveyListContainer">
                    <!-- Survey cards will be populated here -->
                </div>

                <!-- Empty State -->
                <div class="empty-state" id="emptyState" style="display: none;">
                    <div class="empty-state-icon">ğŸ“­</div>
                    <div class="empty-state-text">ì„¤ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤</div>
                    <div class="empty-state-hint">ìƒˆ ì„¤ë¬¸ì„ ë§Œë“¤ì–´ ì‹œì‘í•˜ì„¸ìš”</div>
                </div>
            </div>
        </div>

        <!-- Response Analysis Section -->
        <div class="response-analysis-section">
            <div class="analysis-header">
                <h3>ğŸ“Š ì‘ë‹µë¥  ë¶„ì„</h3>
            </div>

            <!-- Analysis Cards -->
            <div class="analysis-grid" id="analysisGrid">
                <div class="analysis-card">
                    <div class="analysis-value" id="totalResponsesValue">0</div>
                    <div class="analysis-label">ì´ ì‘ë‹µ ìˆ˜</div>
                </div>
                <div class="analysis-card completion">
                    <div class="analysis-value" id="completionRateValue">0%</div>
                    <div class="analysis-label">í‰ê·  ì™„ë£Œìœ¨</div>
                </div>
                <div class="analysis-card dropoff">
                    <div class="analysis-value" id="dropoffRateValue">0%</div>
                    <div class="analysis-label">í‰ê·  ì´íƒˆë¥ </div>
                </div>
            </div>

            <!-- Dropoff Analysis Chart -->
            <div class="dropoff-chart-container" id="dropoffContainer" style="display: none;">
                <div class="dropoff-chart-title">ğŸ¯ ì´íƒˆ ì§€ì  ë¶„ì„</div>
                <div class="dropoff-chart">
                    <canvas id="dropoffChart"></canvas>
                </div>
                <div id="dropoffDetails">
                    <!-- Question dropoff items will be populated here -->
                </div>
            </div>

            <!-- No Data State -->
            <div class="empty-state" id="analysisEmptyState">
                <div class="empty-state-icon">ğŸ“ˆ</div>
                <div class="empty-state-text">ì‘ë‹µ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</div>
                <div class="empty-state-hint">ì„¤ë¬¸ì— ì‘ë‹µì„ ì¶”ê°€í•˜ë©´ ë¶„ì„ ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤</div>
            </div>
        </div>
    </div>

    <!-- Move Folder Modal -->
    <div class="modal-overlay" id="moveFolderModal">
        <div class="modal-dialog">
            <div class="modal-header">
                <h3>í´ë”ë¡œ ì´ë™</h3>
            </div>
            <div class="modal-body">
                <p id="moveFolderInfo" style="margin-bottom:1rem; color:#2c3e50; font-size:0.9rem;"></p>
                <div class="form-group">
                    <label for="moveFolderSelect">í´ë” ì„ íƒ</label>
                    <select id="moveFolderSelect" style="width:100%; padding:0.7rem; border:1px solid #ddd; border-radius:6px; font-size:0.95rem;"></select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-modal btn-modal-secondary" onclick="closeMoveFolderModal()">ì·¨ì†Œ</button>
                <button class="btn-modal btn-modal-primary" onclick="applyMoveFolder()">ì´ë™</button>
            </div>
        </div>
    </div>

    <!-- Share Survey Modal -->
    <div class="modal-overlay" id="shareModal">
        <div class="modal-dialog">
            <div class="modal-header">
                <h3>í€˜ìŠ¤íŠ¸ ê³µìœ </h3>
            </div>
            <div class="modal-body">
                <div style="text-align:center; margin-bottom: 1rem;">
                    <img id="shareQrDash" alt="QR ì½”ë“œ" style="max-width: 200px; height: auto; border: 1px solid #eee; padding: 10px; background: #fff; display:none;" />
                </div>
                <div class="form-group">
                    <label>ê³µìœ  ë§í¬</label>
                    <input type="text" id="shareLinkInputDash" readonly>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-modal btn-modal-secondary" id="closeShareModalBtn">ë‹«ê¸°</button>
                <button class="btn-modal btn-modal-primary" id="copyShareLinkBtn">ë§í¬ ë³µì‚¬</button>
            </div>
        </div>
    </div>

    <!-- Add Folder Modal -->
    <div class="modal-overlay" id="addFolderModal">
        <div class="modal-dialog">
            <div class="modal-header">
                <h3>ìƒˆ í´ë” ë§Œë“¤ê¸°</h3>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>í´ë” ì´ë¦„</label>
                    <input type="text" id="folderNameInput" placeholder="ì˜ˆ: MBTIí˜• ì„¤ë¬¸" autofocus>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-modal btn-modal-secondary" onclick="closeAddFolderModal()">ì·¨ì†Œ</button>
                <button class="btn-modal btn-modal-primary" onclick="createFolder()">ë§Œë“¤ê¸°</button>
            </div>
        </div>
    </div>

    <script src="dashboard.js"></script>
</body>
</html>
