<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì‘ë‹µë¥  ë¶„ì„ - Fantasy Quest</title>
  <link rel="stylesheet" href="styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Gowun+Batang:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
</head>
<body class="analytics-page">
  <div class="app-container">
    <header class="app-header">
      <div class="logo" onclick="navigateTo('index.html')">í€˜ìŠ¤íŠ¸ ì„¤ë¬¸ ë§ˆë²•ì‚¬</div>
      <nav>
        <button class="nav-btn" onclick="navigateTo('index.html')">ëŒ€ì‹œë³´ë“œ</button>
        <button class="nav-btn" onclick="navigateTo('dashboard.html')">ì„¤ë¬¸ ê´€ë¦¬</button>
        <button class="nav-btn" onclick="navigateTo('analytics.html')">ê²°ê³¼ ë¶„ì„</button>
        <button class="nav-btn active" onclick="navigateTo('analytics.html')">ì‘ë‹µë¥  ë¶„ì„</button>
      </nav>
    </header>

    <main class="dashboard" style="max-width: 1280px; margin: 0 auto; padding: 0 16px;">
      <h1>ì‘ë‹µë¥  ë¶„ì„</h1>

      <section class="dashboard-grid kpi-grid">
        <div class="dashboard-card kpi-row">
          <div class="kpi-item">
            <div class="kpi-label">ì„ íƒí•œ ì„¤ë¬¸ ì´ ì‘ë‹µ ìˆ˜</div>
            <div id="kpiSurveyTotal" class="kpi-value">0ê±´</div>
          </div>
          <div class="kpi-item">
            <div class="kpi-label">ì‘ë‹µ ê¸°ê°„</div>
            <div id="kpiDateRangeLabel" class="kpi-value">ìµœê·¼ 7ì¼</div>
          </div>
          <div class="kpi-item">
            <div class="kpi-label">ìµœë‹¤ ì„ íƒ í•­ëª©</div>
            <div id="kpiTopOption" class="kpi-value">-</div>
          </div>
        </div>
      </section>

      <section class="dashboard-grid">
        <div class="dashboard-card">
          <h3>ì„¤ë¬¸ ë° ë¬¸í•­ ì„ íƒ</h3>
          <div class="analytics-toolbar">
            <label for="surveySelector" style="min-width:90px;">ì„¤ë¬¸ ì„ íƒ</label>
            <select id="surveySelector" class="form-control" style="min-width:260px;"></select>
            <label for="questionSelect" style="min-width:90px; margin-left:12px;">ë¬¸í•­ ì„ íƒ</label>
            <select id="questionSelect" class="form-control" style="min-width:260px;"></select>
            <div style="margin-left:auto; display:flex; gap:0.5rem; flex-wrap:wrap;">
              <div class="export-dropdown">
                <button type="button" id="exportToggleBtn" class="btn-modal btn-modal-secondary export-toggle">
                  ğŸ“¥ ë‚´ë³´ë‚´ê¸°
                </button>
                <div id="exportMenu" class="export-menu">
                  <button id="exportJsonBtn" class="btn-modal btn-modal-secondary">JSON ë‚´ë³´ë‚´ê¸°</button>
                  <button id="exportCsvBtn" class="btn-modal btn-modal-secondary">CSV ë‚´ë³´ë‚´ê¸°</button>
                  <button id="exportXlsBtn" class="btn-modal btn-modal-primary">Excel(CSV) ë‚´ë³´ë‚´ê¸°</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="dashboard-card" id="overallDoughnutContainer">
          <div class="chart-card-header">
            <div>
              <h3>ì„ íƒí•œ ë¬¸í•­ â€“ ì„ íƒì§€ ë¶„í¬</h3>
              <p id="selectedQuestionTitle" style="margin:0 0 0.25rem 0; font-weight:600; color:#2c3e50;"></p>
              <p id="selectedQuestionTotal" style="margin:0 0 0.75rem 0; font-size:0.9rem; color:#555;"></p>
            </div>
            <div class="chart-header-controls">
              <select id="dateRangePreset" class="chart-date-select" aria-label="ì‘ë‹µ ê¸°ê°„ ì„ íƒ">
                <option value="7d" selected>ìµœê·¼ 7ì¼</option>
                <option value="1m">ìµœê·¼ 1ê°œì›”</option>
                <option value="6m">ìµœê·¼ 6ê°œì›”</option>
                <option value="1y">ìµœê·¼ 1ë…„</option>
                <option value="all">ì „ì²´ ê¸°ê°„</option>
              </select>
              <div class="chart-type-toggle" aria-label="ì°¨íŠ¸ ìœ í˜• ì„ íƒ">
                <button type="button" class="chart-type-btn active" data-type="doughnut">ë„ë„›</button>
                <button type="button" class="chart-type-btn" data-type="bar">ë§‰ëŒ€</button>
              </div>
            </div>
          </div>
          <div class="chart-and-table">
            <div class="chart-area">
              <div class="chart-canvas-wrap"><canvas id="chart2"></canvas></div>
              <div class="empty-state" id="optionEmpty" style="display:none; margin-top:0.5rem;">ì„ íƒì§€ ê¸°ë°˜ ë¬¸í•­ì„ ì„ íƒí•˜ì„¸ìš”.</div>
            </div>
            <div class="table-area">
              <h4 class="table-title">ìƒì„¸ ë°ì´í„°</h4>
              <div id="optionStatsTable" class="option-stats-table"></div>
            </div>
          </div>
        </div>
      </section>
      <div id="analyticsOutput" style="display:none;"></div>
    </main>
  </div>

  <script src="analytics.js"></script>
  <script>
    function navigateTo(page){ window.location.href = page; }
  </script>
  <style>
    /* Scoped styles for analytics page */
    .analytics-page, .analytics-page .dashboard-card, .analytics-page .nav-btn, .analytics-page select, .analytics-page button, .analytics-page input {
      font-family: 'Gowun Batang', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Noto Sans KR', Arial, sans-serif;
    }

    /* Layout adjustments to reduce excessive side whitespace and improve readability */
    .analytics-page .dashboard {
      max-width: 1280px;
      margin: 0 auto;
      padding: 0 16px;
    }

    /* Single column layout to avoid cards wrapping too much and pushing content downward */
    .analytics-page .dashboard-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 1.25rem;
    }

    /* Toolbar styling (survey select + export buttons) */
    .analytics-page .analytics-toolbar {
      display: flex;
      gap: 1rem;
      align-items: center;
      flex-wrap: wrap;
    }
    .analytics-page .analytics-toolbar label {
      margin: 0;
      color: #2c3e50;
      font-weight: 600;
      min-width: 90px;
    }
    .analytics-page #surveySelect.form-control {
      min-width: 260px;
      padding: 0.6rem 0.8rem;
      border: 1px solid #ddd;
      border-radius: 6px;
      background: #fff;
      color: #2c3e50;
    }
    .analytics-page #surveySelect.form-control:focus {
      outline: none;
      border-color: #4a6baf;
      box-shadow: 0 0 0 3px rgba(74, 107, 175, 0.1);
    }
    .analytics-page .btn-modal {
      padding: 0.6rem 1rem;
      border-radius: 6px;
      font-size: 0.95rem;
    }
    .analytics-page .btn-modal-secondary {
      background: #f3f4f6;
      color: #2c3e50;
    }
    .analytics-page .btn-modal-secondary:hover {
      background: #e5e7eb;
    }
    .analytics-page .btn-modal-primary {
      background: #4a6baf;
      color: #fff;
    }
    .analytics-page .btn-modal-primary:hover {
      background: #3a5a9a;
    }

    /* KPI row above charts */
    .analytics-page .kpi-grid {
      margin-top: 0.5rem;
      margin-bottom: 1rem;
    }
    .analytics-page .kpi-row {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
    }
    .analytics-page .kpi-item {
      flex: 1;
      min-width: 180px;
      padding: 0.85rem 1rem;
      border-radius: 8px;
      background: #f9fafb;
      border: 1px solid #e5e7eb;
    }
    .analytics-page .kpi-label {
      font-size: 0.85rem;
      color: #6b7280;
      margin-bottom: 0.25rem;
    }
    .analytics-page .kpi-value {
      font-size: 1.25rem;
      font-weight: 700;
      color: #111827;
    }

    /* Chart header + chart type toggle */
    .analytics-page .chart-card-header {
      display: flex;
      justify-content: space-between;
      gap: 1rem;
      align-items: flex-start;
      margin-bottom: 0.75rem;
    }
    .analytics-page .chart-header-controls {
      display: flex;
      gap: 0.5rem;
      align-items: center;
    }
    .analytics-page .chart-date-select {
      padding: 0.35rem 0.6rem;
      font-size: 0.85rem;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      background: #fff;
      color: #374151;
    }
    .analytics-page .chart-type-toggle {
      display: inline-flex;
      border-radius: 999px;
      background: #f3f4f6;
      padding: 2px;
    }
    .analytics-page .chart-type-btn {
      border: none;
      background: transparent;
      padding: 0.25rem 0.75rem;
      font-size: 0.85rem;
      border-radius: 999px;
      cursor: pointer;
      color: #4b5563;
    }
    .analytics-page .chart-type-btn.active {
      background: #4a6baf;
      color: #fff;
    }

    /* Chart + table layout */
    .analytics-page .chart-and-table {
      display: grid;
      grid-template-columns: 2fr 1.3fr;
      gap: 1rem;
      align-items: flex-start;
    }
    .analytics-page .chart-area {
      min-height: 300px;
    }
    .analytics-page .chart-canvas-wrap {
      height: 300px;
      overflow-x: auto;
    }
    .analytics-page .chart-canvas-wrap canvas {
      min-width: 480px;
    }
    .analytics-page .table-area {
      border-left: 1px solid #e5e7eb;
      padding-left: 1rem;
    }
    .analytics-page .table-title {
      margin: 0 0 0.5rem 0;
      font-size: 0.95rem;
      color: #374151;
    }
    .analytics-page .option-stats-table {
      font-size: 0.85rem;
    }
    .analytics-page .option-stats-table table {
      width: 100%;
      border-collapse: collapse;
    }
    .analytics-page .option-stats-table th,
    .analytics-page .option-stats-table td {
      padding: 0.35rem 0.25rem;
      border-bottom: 1px solid #e5e7eb;
    }
    .analytics-page .option-stats-table th {
      font-weight: 600;
      color: #4b5563;
    }

    /* Export dropdown */
    .analytics-page .export-dropdown {
      position: relative;
    }
    .analytics-page .export-toggle {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
    }
    .analytics-page .export-menu {
      position: absolute;
      right: 0;
      top: 110%;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 10px 30px rgba(15, 23, 42, 0.16);
      padding: 0.4rem;
      display: none;
      flex-direction: column;
      gap: 0.25rem;
      min-width: 180px;
      z-index: 10;
    }
    .analytics-page .export-menu.open {
      display: flex;
    }
    .analytics-page .export-menu .btn-modal {
      width: 100%;
      justify-content: flex-start;
    }

    /* Make charts area breathe nicely */
    .analytics-page #dropoffContainer h3,
    .analytics-page #perSurveyContainer h3 {
      margin-bottom: 0.75rem;
    }

    @media (max-width: 900px) {
      .analytics-page .chart-and-table {
        grid-template-columns: 1fr;
      }
      .analytics-page .table-area {
        border-left: none;
        border-top: 1px solid #e5e7eb;
        padding-left: 0;
        padding-top: 0.75rem;
      }
    }
  </style>
</body>
</html>
