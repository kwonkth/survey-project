<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>응답률 분석 - Fantasy Quest</title>
  <link rel="stylesheet" href="styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Gowun+Batang:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
</head>
<body class="analytics-page">
  <div class="app-container">
    <header class="app-header">
      <div class="logo" onclick="navigateTo('index.html')">퀘스트 설문 마법사</div>
      <nav>
        <button class="nav-btn" onclick="navigateTo('index.html')">대시보드</button>
        <button class="nav-btn" onclick="navigateTo('dashboard.html')">설문 관리</button>
        <button class="nav-btn" onclick="navigateTo('analytics.html')">결과 분석</button>
        <button class="nav-btn active" onclick="navigateTo('analytics.html')">응답률 분석</button>
      </nav>
    </header>

    <main class="dashboard" style="max-width: 1280px; margin: 0 auto; padding: 0 16px;">
      <h1>응답률 분석</h1>

      <section class="dashboard-grid">
        <div class="dashboard-card">
          <h3>설문 및 문항 선택</h3>
          <div class="analytics-toolbar">
            <label for="surveySelector" style="min-width:90px;">설문 선택</label>
            <select id="surveySelector" class="form-control" style="min-width:260px;"></select>
            <label for="questionSelect" style="min-width:90px; margin-left:12px;">문항 선택</label>
            <select id="questionSelect" class="form-control" style="min-width:260px;"></select>
            <div style="margin-left:auto; display:flex; gap:0.5rem; flex-wrap:wrap;">
              <button id="exportJsonBtn" class="btn-modal btn-modal-secondary">JSON 내보내기</button>
              <button id="exportCsvBtn" class="btn-modal btn-modal-secondary">CSV 내보내기</button>
              <button id="exportXlsBtn" class="btn-modal btn-modal-primary">Excel(CSV) 내보내기</button>
            </div>
          </div>
        </div>

        <div class="dashboard-card" id="selectedDropoutContainer">
          <h3>전체 문항 비교 – 응답 수 요약 (가로 막대)</h3>
          <div style="height:300px"><canvas id="chart1"></canvas></div>
          <div class="empty-state" id="dropoutEmpty" style="display:none; margin-top:0.5rem;">선택한 설문의 문항이 없습니다.</div>
        </div>

        <div class="dashboard-card" id="overallDoughnutContainer">
          <h3>선택한 문항 – 선택지 분포 (도넛)</h3>
          <p id="selectedQuestionTitle" style="margin:0 0 0.5rem 0; font-weight:600; color:#2c3e50;"></p>
          <div style="height:300px"><canvas id="chart2"></canvas></div>
          <div class="empty-state" id="optionEmpty" style="display:none; margin-top:0.5rem;">선택지 기반 문항을 선택하세요.</div>
        </div>
      </section>
      <div id="analyticsOutput" style="display:none;"></div>
    </main>
  </div>

  <script src="analytics.js"></script>
  <script>
    function navigateTo(page){ window.location.href = page; }
  </script>
  <style>
    /* Scoped styles for analytics page */
    .analytics-page, .analytics-page .dashboard-card, .analytics-page .nav-btn, .analytics-page select, .analytics-page button, .analytics-page input {
      font-family: 'Gowun Batang', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Noto Sans KR', Arial, sans-serif;
    }

    /* Layout adjustments to reduce excessive side whitespace and improve readability */
    .analytics-page .dashboard {
      max-width: 1280px;
      margin: 0 auto;
      padding: 0 16px;
    }

    /* Single column layout to avoid cards wrapping too much and pushing content downward */
    .analytics-page .dashboard-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 1.25rem;
    }

    /* Toolbar styling (survey select + export buttons) */
    .analytics-page .analytics-toolbar {
      display: flex;
      gap: 1rem;
      align-items: center;
      flex-wrap: wrap;
    }
    .analytics-page .analytics-toolbar label {
      margin: 0;
      color: #2c3e50;
      font-weight: 600;
      min-width: 90px;
    }
    .analytics-page #surveySelect.form-control {
      min-width: 260px;
      padding: 0.6rem 0.8rem;
      border: 1px solid #ddd;
      border-radius: 6px;
      background: #fff;
      color: #2c3e50;
    }
    .analytics-page #surveySelect.form-control:focus {
      outline: none;
      border-color: #4a6baf;
      box-shadow: 0 0 0 3px rgba(74, 107, 175, 0.1);
    }
    .analytics-page .btn-modal {
      padding: 0.6rem 1rem;
      border-radius: 6px;
      font-size: 0.95rem;
    }
    .analytics-page .btn-modal-secondary {
      background: #f3f4f6;
      color: #2c3e50;
    }
    .analytics-page .btn-modal-secondary:hover {
      background: #e5e7eb;
    }
    .analytics-page .btn-modal-primary {
      background: #4a6baf;
      color: #fff;
    }
    .analytics-page .btn-modal-primary:hover {
      background: #3a5a9a;
    }

    /* Make charts area breathe nicely */
    .analytics-page #dropoffContainer h3,
    .analytics-page #perSurveyContainer h3 {
      margin-bottom: 0.75rem;
    }
  </style>
</body>
</html>
